machine:
  php:
    version: 5.6.2
  environment:
   PATH: ${HOME}/${CIRCLE_PROJECT_REPONAME}/vendor/bin:${PATH}

dependencies:
  override:
  # Run installation of all dependencies unsing composer locally.
  - cd $HOME/$CIRCLE_PROJECT_REPONAME && composer config -g github-oauth.github.com $GITHUB_TOKEN
  - cd $HOME/$CIRCLE_PROJECT_REPONAME && composer install
  # Run a second part of the installation to link all required parts.
  - cd $HOME/$CIRCLE_PROJECT_REPONAME && bash dcr install

test:
  pre:
  # Install bats CLI testing.
  - sudo add-apt-repository ppa:duggan/bats --yes
  - sudo apt-get update -qq
  - sudo apt-get install -qq bats
  override:
  # Run environment tests.
  - source ~/.profile && bats tests/bats/environment.bats
  # Run app tests.
  - source ~/.profile && bats tests/bats/app.bats
