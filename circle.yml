machine:
  php:
    version: 5.3.10
  environment:
   PATH: ${HOME}/${CIRCLE_PROJECT_REPONAME}/vendor/bin:${PATH}

dependencies:
  pre:
  # Update composer to the latest version.
  - sudo composer self-update
  # Install bats CLI testing.
  - sudo add-apt-repository ppa:duggan/bats --yes
  - sudo apt-get update -qq
  - sudo apt-get install -qq bats
  override:
  # Refresh environment variables.
  - phpenv rehash
  # Run installation of all dependencies unsing composer.
  - cd $HOME/$CIRCLE_PROJECT_REPONAME && composer install
  # Run a second part of the installation to link all required parts.
  - cd $HOME/$CIRCLE_PROJECT_REPONAME && bash dcr install

test:
  override:
  # Run environment tests.
  - source ~/.profile && bats tests/bats/environment.bats
